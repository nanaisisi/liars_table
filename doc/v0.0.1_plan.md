# Liar's Table v0.0.1 実装計画（改訂版）

> **作成日**: 2025 年 7 月 29 日（改訂）  
> **対象バージョン**: v0.0.1  
> **前提**: 初期バージョン開発

## 初期実装の成果と課題

### ✅ v0.0.1 で達成できたもの（基盤機能）

1. **シンプルな対話式 UI**: 直感的で使いやすい基本 UI
2. **多言語対応**: 日本語・英語の国際化対応
3. **プレイヤー管理**: 名前設定とプレイヤー情報管理
4. **ロシアンルーレット**: 確率設定可能な基本機能
5. **設定の永続化**: TOML 形式での設定保存

### 🤔 v0.0.1 の現在の課題（次バージョンで解決）

1. **カードゲーム要素の不足**: ロシアンルーレットのみで実際のゲーム要素が未実装
2. **ゲームフローの不完全**: 物理カードとの連携機能が不足
3. **順番管理の未完成**: プレイヤー間のターン制システムが未実装

## v0.0.2 の実装戦略: **完全なカードゲーム体験**

### 🎯 核心アイデア: **順番制チャレンジシステム**

**現実的な想定**:

- プレイヤーは実際のカードで遊んでいる
- プログラムは「次のプレイヤーの判断」を助ける
- 自然な順番でゲームが進行する

## v0.3 の機能仕様（シンプル設計）

### 基本フロー: 自然なカードゲーム補助

```
=== Liar's Table v0.3 ===
現在のターン: 太郎

1. カードプレイ記録
   → 太郎が ACE 2枚を宣言して出した

2. 次のプレイヤー判断
   → 花子のターン: Accept / Challenge?

3. 結果処理
   → Challenge → カード確認 → ロシアンルーレット
```

### 核心機能: 順番制チャレンジシステム

#### 1. **カードプレイ記録**

```rust
struct CardPlay {
    player_name: String,        // "太郎"
    declared_type: CardType,    // ACE, QUEEN, KING
    card_count: u8,            // 出したカード枚数
}
```

**UI 例**:

```
太郎のターンです
✔ 宣言する種類: › ACE
✔ 出すカード枚数: › 2
→ 太郎が ACE 2枚を宣言しました
```

#### 2. **次プレイヤーの選択**

```rust
enum ChallengeDecision {
    Accept,      // 信じる → ゲーム続行
    Challenge,   // 疑う → カード確認へ
}
```

**UI 例**:

```
花子のターンです
太郎の宣言: ACE 2枚

✔ どうしますか？
  › Accept (信じる)
    Challenge (Liarだと思う)
```

#### 3. **チャレンジ結果処理**

```rust
struct ChallengeResult {
    challenger: String,      // "花子"
    target: String,         // "太郎"
    actual_cards: String,   // "実際は QUEEN 1枚, JOKER 1枚"
    is_liar: bool,         // true = 嘘だった
    roulette_target: String, // ロシアンルーレット対象
}

struct PlayerStatus {
    name: String,
    is_active: bool,       // false = 脱落済み
    games_won: u32,        // 勝利回数
}

struct GameState {
    players: Vec<PlayerStatus>,
    current_player_index: usize,
    active_player_count: usize,
}

impl GameState {
    // アクティブプレイヤーのみを返す
    fn get_active_players(&self) -> Vec<&PlayerStatus> {
        self.players.iter().filter(|p| p.is_active).collect()
    }

    // 次のアクティブプレイヤーに移る
    fn next_active_player(&mut self) {
        loop {
            self.current_player_index = (self.current_player_index + 1) % self.players.len();
            if self.players[self.current_player_index].is_active {
                break;
            }
        }
    }

    // ゲーム継続可能かチェック
    fn can_continue(&self) -> bool {
        self.active_player_count > 1
    }
}
```

**UI 例**:

```
=== チャレンジ結果 ===
太郎が実際に出したカード:
✔ 1枚目: › QUEEN
✔ 2枚目: › JOKER

判定: 嘘でした！（ACE ではない）
→ 太郎がロシアンルーレット

=== ロシアンルーレット結果 ===
太郎: OUT！
→ 太郎が脱落しました

残りプレイヤー: 花子、次郎（2/4人）
太郎の次のターンだったので、花子に移ります
次のターン: 花子

=== ゲーム状況 ===
✓ 花子 (アクティブ)
✓ 次郎 (アクティブ)
✗ 太郎 (脱落)
✗ 三郎 (脱落)
```

**ゲーム終了時の例**:

```
=== ゲーム終了 ===
🎉 勝者: 花子！

最終結果:
🏆 花子 (勝者)
✗ 次郎 (2位 - 脱落)
✗ 太郎 (3位 - 脱落)
✗ 三郎 (4位 - 脱落)
```

### 実装する機能（最小限）

#### ✅ Phase 3A: 基本ゲームフロー（1 週間）

1. **カードプレイ記録機能**

   - 現在のプレイヤー表示
   - 宣言種類選択（ACE/QUEEN/KING）
   - 枚数入力（1-5 枚）

2. **チャレンジ判断機能**

   - 次のプレイヤーへの自動遷移
   - Accept/Challenge 選択
   - ターン進行管理

3. **カード確認・判定機能**

   - 実際のカード入力
   - 嘘判定（JOKER 対応）
   - ロシアンルーレット対象決定

4. **脱落判定・ゲーム終了処理**
   - プレイヤー脱落管理
   - **アクティブプレイヤーリストの更新**
   - **ターン順序の再計算**（脱落者をスキップ）
   - 勝者判定（最後の 1 人）
   - ゲーム終了時の結果表示

#### ✅ Phase 3B: 体験向上（1 週間）

1. **ゲーム記録**

   - プレイ履歴の表示
   - 簡単な統計（勝敗数）

2. **UI 改善**
   - 現在の状況表示の充実
   - エラーハンドリング向上

### 削除する複雑な要素

❌ **モード選択**: 物理カード前提で統一
❌ **デジタル完結モード**: v0.0.1では実装不要
❌ **複雑な統計**: 最小限の記録のみ
❌ **AI 対戦**: 将来機能として除外
❌ **エクスポート機能**: 過剰仕様

## 技術実装（最小限設計）

### アーキテクチャ

```
src/
├── game_flow.rs      # ゲーム進行管理（新規）
├── challenge.rs      # チャレンジ機能（新規）
├── player_status.rs  # プレイヤー状態管理（新規）
├── config.rs         # v0.2から継承
├── i18n.rs          # v0.2から継承
├── interactive.rs    # v0.2を拡張
├── roulette.rs      # v0.2から継承
└── main.rs          # 拡張
```

### 新規依存関係（最小限）

```toml
# v0.2の依存関係はそのまま継承
# 新規追加なし（既存のserde_jsonで記録管理）
```

## 開発計画（現実的）

### Phase 3A: 基本ゲームフロー（1 週間）

- [ ] カードプレイ記録機能
- [ ] 順番制ターン管理
- [ ] チャレンジ選択機能
- [ ] カード確認・判定機能
- [ ] 脱落判定・ゲーム終了処理

### Phase 3B: 体験向上（1 週間）

- [ ] プレイ履歴表示
- [ ] 基本統計機能
- [ ] UI 改善・エラーハンドリング

**合計: 2 週間程度（現実的）**

## 期待される効果

### 1. **自然なゲーム進行**

```
太郎 → カード出し → 花子 → Accept/Challenge →
→ 太郎脱落 → 花子と次郎で継続 → 次郎勝利
```

実際のカードゲームの流れそのまま
**脱落者を自動的にスキップして継続**

### 2. **シンプルな操作**

- プレイヤーは順番に判断するだけ
- 複雑な選択肢やモード切り替えなし
- v0.2 の良い UI を活用

### 3. **実用的な補助機能**

- 物理カードゲームの「判定」を正確に
- 「次は誰のターン？」が明確
- **脱落プレイヤーを自動的にスキップ**
- **残りプレイヤー数の表示**
- ロシアンルーレット結果の公平性

## 成功指標（シンプル）

### 基本動作

- [ ] 3 人でのゲーム進行が完全動作
- [ ] Accept/Challenge の判定が正確
- [ ] ロシアンルーレットがスムーズに実行
- [ ] 脱落プレイヤーの管理が適切
- [ ] 勝者判定とゲーム終了処理が正常動作

### ユーザビリティ

- [ ] 初回プレイ時に操作方法が直感的に理解できる
- [ ] 「次に何をすべきか」が常に明確
- [ ] エラー時の復旧が簡単

---

**v0.3 は「自然な順番制カードゲーム補助ツール」として、シンプルで実用的な機能に絞り込みます。**

複雑なモード選択や統計機能ではなく、実際のカードゲームプレイ時の「次のプレイヤーの判断」を自然にサポートすることに集中し、v0.2 の良い UI とプレイヤー管理機能を最大限活用します。
